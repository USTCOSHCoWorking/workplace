# 立项依据

标签（空格分隔）： 分布式包分发 目的 意义

---

>现象与弊端

---
##现状与方向
　　首先，关于我们做的包分发系统为什么一定要采用分布式的问题。
###关于中心化
　　众所周知, 互联网是建立在HTTP协议上的. HTTP协议是个伟大的发明, 让我们的互联网得以快速发展.但是互联网发展到了今天HTTP逐渐出来了不足.
1. 中心化是低效的, 并且成本很高
2. Web文件经常被删除
3. 中心化限制了web的成长
4. 互联网应用高度依赖主干网

* 关于第一点：使用中心化的服务器下载完整的文件(网页, 视频, 图片等), 速度慢, 效率低. 如果改用P2P的方式下载, 可以节省近60%的带宽. P2P将文件分割为小的块, 从多个服务器同时下载, 速度非常快.
* 关于第二点：回想一下是不是经常你收藏的某个页面, 在使用的时候浏览器返回404(无法找到页面), http的页面平均生存周期大约只有100天. Web文件经常被删除(由于存储成本太高), 无法永久保存. 而我们做的包分发系统，会类似IPFS一样提供了文件的历史版本回溯功能(就像git版本控制工具一样), 可以很容易的查看文件的历史版本, 数据可以得到永久保存
* 关于第三点：我们的现有互联网是一个高度中心化的网络. 互联网是人类的伟大发明, 也是科技创新的加速器. 各种管制将对这互联网的功能造成威胁, 例如: 互联网封锁, 管制, 监控等等. 这些都源于互联网的中心化.而分布式的系统可以克服这些web的缺点.
* 主干网受制于诸多因素的影响, 战争, 自然灾害, 互联网管制, 中心化服务器宕机等等, 都可能是我们的互联网应用中断服务. 使用分布式系统可以是互联网应用极大的降低互联网应用对主干网的依赖.

>由以上可以看出，不仅仅是我们要做的包分发系统，各种应用，只要需要投入到互联网当中去，都会产生类似的问题。

---

###关于软件包管理与分发的现状

>现在我们自己使用的软件包的管理软件都要配置一个好的，稳定的软件源

　　我们用的这些源一般就是镜像源，比如：科大镜像，清华镜像，豆瓣等。
那么这就会引出来一个相应的问题：**这些镜像由谁来维护呢？**

**这些镜像站是公益的！**

引用科大镜像源的一段历史：
　　科大最早的镜像站诞生于2001年3月。2002年的时候，开始使用 debian.ustc.edu.cn 域名。2005年，科大LUG发出fund raising campaign，利用捐款买了一台机器，而2008年时，吴峰光先生捐献了一台整机给科大，又有一人捐赠了硬盘，使一个新的镜像站点诞生，那就是**oss.ustc.edu.cn**。

**引用一位曾经科大镜像的维护人员张成的说明：**
　　我在 2010年左右接手维护 {debian,oss}.http://ustc.edu.cn。而从最初一直到我接手的这段时间，两个镜像站点一直在打游击战，一般都放在当时维护者所在的实验室（因此当时的维护者也基本都是研究生），每次当期维护者毕业之后就要搬迁一次。在2011年左右，由于debian.ustc的访问量越来越大，老的机器数次宕机。同时，硬盘仓位也已经填满，无法继续添加新的硬盘，老机器已经不再适合继续服役了。此时，网络中心的 jameszhang 老师捐赠了一台新的服务器，我们将 {debian,oss}.ustc 两台机器上的内容全部迁移到了新的服务器上，并且启用了新的域名：http://mirrors.ustc.edu.cn （瀚海星云 精华区文章阅读:mirrors.ustc.edu.cn正式开张）。

>就此，我们可以看出镜像的第一点弊端，硬盘空间要不停扩张，到一个程度甚至需要增添新的服务器。
访问量过大也会对镜像站提出越来越高的要求

　　精华区在维护镜像站期间，为了找到合适的上游镜像，也找过许多国外的镜像站。我发现大多数规模比较大的镜像站，都是由学校学生维护的，也托管于学校。在国外，由于人力成本比较高，而学生维护则基本没有人力成本（不需要支付工资），带宽成本基本可以忽略。常常是一些组织给学校赞助机器，然后由学生来维护镜像站。国内的情况稍不同，但是结果是一样的。

>从这里可以看出为了维护一个镜像站，需要专业人员的不停维护（包含学生），对人力的有持续的需求

　　而且国内由商业组织维护的镜像站点，我知道的最早的是 http://mirrors.anheng.com.cn/debian/ （当年也是Debian在中国的官方镜像之一）。其实严格来说，这个镜像站并不算是商业组织维护的。维护者是该公司的刘世伟（似乎有江湖名号龙芯三剑客之一，另外两个是张乐和孙海勇）。刘世伟利用其公司办公室的带宽提供这个镜像服务。大概在3年前，我参观了一次安恒公司，他们的带宽只有 4Mbps，现在估计也没有增加。所以，这个镜像其实在许多年前就已经没有能力提供优质的服务了。在 debian.ustc 流行起来之后，这个镜像站就已经很少为人所知了。然后 163、sohu 的镜像也出来了。现在由商业公司维护的开源镜像就越来越多了。例如各云主机厂商一般都会提供，还有一些文艺范的公司，比如豆瓣之类的，也会提供。

>现在软件源的需求可见一斑，由此，若能够使得包的分发摆脱了传统镜像源所固有的缺陷，这便是需求的所在，也**正是我们开发分布式包分发系统的意义**

　　国内的带宽成本非常高，而相对来说，一些高校的带宽很富裕，对带宽成本并不敏感，所以镜像站点大多数也都在高校中。而科大的新的镜像站点，不知为何知名度挺高，上线没多久压力就非常大，一度打满千兆网卡。系统各方面都碰到了瓶颈，为此不得不做更多的优化，尝试更多的技术。

>由于镜像站也是属于趋中心化的，其巨大的访问，会导致其对服务器带宽的要求额外的高。一个很讽刺的例子就是使大多百度云盘用户感到困扰的限速问题：现在使用百度云的用户都知道，要从百度的云端上将自己存储的大文件下载下来是一件多么有难度的事，就前两年来说，使用百度云下载（如果没有VIP），带宽会被限速至100Kbps。在如今人均带宽都在逐年提升的进程中，这是多么让人难过的事。为什么？因为百度云盘的用户过于庞大，如果人人都要以自家最大带宽来访问百度云，那么服务器就无法承受了。

　　再说商业公司。首先，服务器比较多一些的商业公司，一般都会自己搭建镜像站（只是大多数没有对公开放）。上百上千台服务器，要装个软件都得用一下公网镜像，也是很可怕的事情，一方面网速慢，另一方面，万一公网镜像挂了就悲剧了，不能依赖于不可控的第三方镜像。所以，这些商业公司都会自己在内网搭建一个镜像站。而云主机厂商，更进一步的，不仅自己要用，自己的客户也要用。像阿里云，算上所有的虚拟机，数量可能在几十万到几百万这个量级，如果他们不提供镜像，那么任何一个第三方的镜像站都可能被压挂。

>由此看来，不仅有学校科研的需求，各大商业公司也都有对软件源的需求，为了防止公网镜像失效产生的后果，不得不投入资金在自己搭建镜像站。同样，这也需要人维护。

　　镜像站本身是无法盈利的。因此提供镜像站点本身肯定都是公益的。开源镜像服务却并没有合适的盈利模式（至少现在还没有发现），对用户收钱肯定是不合适的，这会极大的打击大家参与开源活动的积极性。广告也是不可能的，开源站虽然流量大，但是几乎没有PV。因为没有合适的盈利模式，我认为在接下来的很长的时间内，开源镜像服务可能主要还是由高校以及对开源服务依赖比较强的商业公司提供。然而，学校的带宽是有上限的，随着开源社区越来越庞大，学校的资源会无法满足开源社区的需求，因此，接下来，商业公司会成为开源镜像服务的主力。

>如此重要的镜像站，无法盈利，却需要自身投入大量成本，这固然已经成为其缺陷之一了

####**由以上对镜像站的说明，我们可以得到以下几点：**

* 镜像站需要不停更新硬件，以满足对存储空间的逐步扩大的需求。包括（硬盘，服务器）
* 镜像站会由于访问量的提升涉及到：1.系统稳定性要求，不至于使服务器崩溃。
　　　　　　　　　　　　　　　　2.带宽的量与成本的需求
* 选定镜像站后，由于是单一源，下载速度受到限制
* 对于软件包分发的需求是足够大的，各个镜像站的存在对资源产生了过度浪费，对其优化甚至革新是有价值的
* 镜像站没有合适的盈利机制，需要单方面投入成本

####**针对以上问题，可以得出分布式包分发系统的优越性**

|镜像站存在的问题|分布式包分发系统给予的方案|
|----|---|
|镜像站需要不停更新硬件，以满足对存储空间的逐步扩大的需求。包括（硬盘，服务器）|分布式包分发系统的站点是每个用户，硬件是否更新取决于用户自身，新的空间来源来自于新的用户，无需强制更新|
|镜像站会由于访问量的提升涉及到：1.系统稳定性要求，不至于使服务器崩溃。2.带宽的量与成本的需求|1.由于系统是分布性的，采用区块链模式，并不要求每个节点都随时在线，即使个人电脑出现故障，也不会影响整个系统，因此系统是稳定的。2.由于下载来源各个节点，不会对单一节点造成过大带宽负担。|
|由于是单一源，下载速度受到限制|由于是多个源，在来源方面不会受到带宽限制，可以达到自身最大带宽|
|对于软件包分发的需求是足够大的，各个镜像站的存在对资源产生了过度浪费|此系统使用的资源都只是各个电脑节点中的一小部分，不会造成大的资源浪费|
|镜像站没有合适的盈利机制，需要单方面投入成本|这个系统不需要盈利，符合开源理念，其哲学为“有付出才有回报”，自身提供小部分硬盘空间，得到优质的包分发服务。|

####关于方向
系统必须拥有的性质：

* 离散型(Autonomy and decentralization): 构成系统的节点之间都是对等的, 没有中央控制机制进行协调
* 伸缩性(Scalability): 不论系统有多少节点, 都要求高效工作
* 容错性(Fault tolerance):不断有节点加入和离开,不会影响整个系统的工作

对于方向问题，采取**Q&A**方式阐明：
**此处对比其他分布式系统**：namecoin、洋葱网络、storj、还有现在大热的ipfs

他们共同面临的问题有两个：

1. 法律问题，这种东西无法监管，有害信息深恶痛绝
**A:** 我们的分布式包分发系统会于官方软件源保持同步，不会存在除了软件包以为的有害信息。
2. 标准问题，没有大型组织来统一制定标准，比如IE不支持，便很难对普通大众普及使用。
**A:** 我们初步使用的是命令行使用方式，制作成软件，制作全新的一套包分发软件系统，不需要IE等支持。

更多疑问：

a.节点的所有者可以自由选择想要维持的数据，如果有个数据大家都不愿意存储，是不是意味着如果上传者删除了该数据，那么这个数据也就从此消失了呢？
**A:** 我们的系统采取区块链的方式存储，并不需要节点存储完整软件的所有块，所有者并不是自由选择想要维持的数据，而是有系统同样分配，节点只需要提供存储空间即可

b.相同内容的文件在系统中只会存在一份，节约存储空间。如果这份文件都没有人Pinning，是不是意味着也有消失的可能？是不是IPFS还有一部分主动备份所有数据的功能？
**A:** 我们的数据不止存储一份，至于存储的份数，这是由系统中的特殊评判标准决定的

c.如何保证节点的所有者可以自由选择想要维持的数据？共享了硬盘后，写入的数据貌似我们是不知晓的，只是做了一个传播的媒介？
**A:** 不保证自由选择，这没有什么意义，但我们会采取相应的奖励机制，使得有付出有回报。

由以上Q&A，我们已经可以得出做这个项目的**必要依据**了：

* 虽是分布式系统，但只涉及包分发，可以避免很多分布式文件系统的缺陷
* 分布式包分发系统对镜像源的一系列缺陷的避免，是对企业，学校教育，科研需求的正确考量，具有足够的价值。
* 符合CAP理念：扩展性好。支持线性扩容，当存储空间不足时，可以采用热插拔的方式增加存储设备，扩展方便。可靠性强。分布式文件系统包含冗余机制，自动对数据实行备份，在数据发生损坏或丢失的情况下，可以迅速恢复。可用性好。用户只需要拥有网络就可以随时随地的访问数据，不受设备、地点的限制。


###参考来源：
https://www.zhihu.com/question/19719790（关于镜像站的主要参考，张成）
https://zhuanlan.zhihu.com/p/32615963
https://www.zhihu.com/question/37439960
https://www.jianshu.com/p/50047ed80aa9
http://www.infoq.com/cn/articles/features-and-design-concept-of-distributed-system
http://blog.51cto.com/xiexiaojun/1855211
https://image.hanspub.org/Html/1-2690253_20184.htm
